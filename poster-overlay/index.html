<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Poster Overlay</title>
  <link rel="icon" type="image/svg+xml" href="../assets/mediux.svg" />
  <link href="https://fonts.googleapis.com/css2?family=Gabarito:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      font-family: 'Gabarito', sans-serif;
      background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
      color: white;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow-x: hidden;
	  overflow-y: auto;
    }
    header {
      padding: 1rem 2rem;
      display: flex;
      justify-content: center;
      align-items: center;
      background: rgba(0, 0, 0, 0.6);
      box-shadow: 0 0 30px rgba(0, 255, 255, 0.15);
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(8px);
      position: relative;
      z-index: 10;
    }
    .header-left {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      position: absolute;
      left: 2rem;
    }
    .header-left h1 {
      font-size: 1.5rem;
      margin: 0;
      color: white;
	  position: relative;
	  top: -1px;
    }
    .header-center {
      display: flex;
      justify-content: center;
    }
    .poster-tools-brand {
      height: 60px;
      filter: drop-shadow(0 0 6px rgba(0,255,255,0.5));
      transform: translateX(140px);
    }
    .layout {
      display: flex;
      flex: 1;
      overflow: hidden;
    }
    .sidebar {
      width: 280px;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(6px);
      box-shadow: 0 0 30px rgba(0, 255, 255, 0.1);
      padding: 1.5rem;
      border-right: 1px solid rgba(255,255,255,0.05);
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
      box-sizing: border-box;
      align-items: center;
    }
    .sidebar button,
    .sidebar select {
      width: 100%;
      padding: 0.6rem;
      font-size: 0.95rem;
      border: none;
      border-radius: 6px;
      box-sizing: border-box;
      background: white;
      color: black;
      font-weight: bold;
      cursor: pointer;
    }
    #reset-btn {
      background: #ff4d4d;
      color: white;
      font-weight: bold;
      border: none;
    }
    .drop-zone-label {
      border: 2px dashed #ccc;
      padding: 0.8rem 0.1rem;
      text-align: center;
      border-radius: 6px;
      cursor: pointer;
      color: #ccc;
      width: 100%;
      font-size: 0.95rem;
      font-weight: bold;
      background: transparent;
    }
    .sidebar input[type="file"] {
      display: none;
    }
    .sidebar label {
      font-size: 0.9rem;
      color: #eee;
      width: 100%;
      text-align: center;
      margin-bottom: 0.2rem;
    }
    #overlay-select {
      background: #f4f4f4;
      color: #111;
      font-weight: bold;
      text-align: center;
    }

.main {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 4rem;
  gap: 2rem;
  overflow-y: auto;
}

.main-content {
  display: flex;
  gap: 2rem;
  justify-content: center;
  align-items: flex-start;
  flex-wrap: wrap;
}
    .canvas-container {
      width: 550px;
      height: 800px;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #111;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.6);
    }
    canvas {
      width: 100%;
      height: 100%;
      border-radius: 12px;
    }

    .metadata-panel {
      width: 380px;
      height: 8;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      gap: 1.2rem;
      padding: 2rem;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(16px);
      border-radius: 20px;
      box-shadow: 0 0 30px rgba(0, 255, 255, 0.15);
      color: white;
      font-size: 1rem;
      overflow-y: auto;
      border: 1px solid rgba(255,255,255,0.05);
    }
    .title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .title-row h2 {
      font-size: 1.6rem;
      margin: 0;
      flex: 1;
      color: white;
    }
    .rating-badge {
      background: linear-gradient(135deg, #ffcc00, #ffa500);
      color: #111;
      font-weight: 800;
      font-size: 1rem;
      padding: 6px 10px;
      border-radius: 12px;
      box-shadow: 0 0 8px rgba(255, 204, 0, 0.3);
      white-space: nowrap;
    }
    .info-pair {
      font-weight: 600;
      color: #ccc;
	}
	.info-group {
      background: rgba(255,255,255,0.03);
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: 1rem;
	  display: flex;
	  flex-direction: column;
	  gap: 0.9rem;
	}
	.info-item {
	  font-size: 1rem;
      line-height: 1.5;
      color: #ddd;
	}
	.info-item .label {
      color: #fff;
      font-weight: 700;
      margin-right: 0.4rem;
    }
    .tagline {
      font-style: italic;
      font-size: 1.05rem;
      color: #aaa;
    }
    .overview {
      margin-top: auto;
      font-size: 1rem;
      line-height: 1.6;
      color: #ddd;
    }
	.tmdb-search {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 1rem;
}
.tmdb-search {
  position: relative;
  width: 100%;
}

#tmdb-search-input {
  width: 100%;
  padding: 0.5rem;
  font-size: 0.95rem;
  border-radius: 6px;
  border: none;
  box-sizing: border-box;
}

.autocomplete-suggestions {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  z-index: 100;
  background: white;
  color: black;
  border-radius: 0 0 6px 6px;
  overflow: hidden;
  box-shadow: 0 8px 16px rgba(0,0,0,0.3);
  max-height: 220px;
  overflow-y: auto;
}

.autocomplete-suggestions div {
  padding: 0.5rem 0.75rem;
  cursor: pointer;
  transition: background 0.2s;
  font-weight: 600;
}

.autocomplete-suggestions div:hover {
  background: #eee;
}

#poster-modal {
  width: 100%;
  display: none;
  flex-direction: column;
  align-items: center;
  margin-top: 2rem;
}

.poster-grid {
  display: flex;
  flex-direction: row;
  gap: 0.75rem;
  padding: 1rem;
  width: calc(130px * 10 + 0.7rem * 9); /* 10 posters + 9 gaps */
  max-width: 100%;
  overflow-x: auto;
  scroll-snap-type: x mandatory;
  scrollbar-width: thin;
  scrollbar-color: #00ffff rgba(255, 255, 255, 0.05);
  scroll-behavior: smooth;
  scroll-padding-left: 1rem;
  background: rgba(0, 0, 0, 0.35);
  border-radius: 12px;
  box-shadow: 0 0 20px rgba(0,255,255,0.1);
  white-space: nowrap;
}

.poster-grid::-webkit-scrollbar {
  height: 8px;
}

.poster-grid::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 6px;
}

.poster-grid::-webkit-scrollbar-thumb {
  background-color: #00ffff;
  border-radius: 6px;
  border: 2px solid rgba(15, 10, 30, 0.9);
}

.poster-grid::-webkit-scrollbar-thumb:hover {
  background-color: #0ff;
}

.poster-grid img {
  width: 130px; /* tighter fit for more headroom */
  height: 200px;
  object-fit: cover;
  flex: 0 0 auto;
  border-radius: 6px;
  scroll-snap-align: start;
  cursor: pointer;
  transition: transform 0.2s;
  box-shadow: 0 2px 6px rgba(0,0,0,0.4);
}

.poster-grid img:hover {
  transform: scale(1.05);
}

.poster-grid-wrapper {
  overflow-x: auto;
  padding: 0 1rem; /* consistent left and right padding */
  scroll-snap-type: x mandatory;
  -webkit-overflow-scrolling: touch;
  max-width: 1440px;
} 

.poster-wrapper {
  scrollbar-gutter: stable both-edges;
}

.close-modal {
  position: absolute;
  top: -2.5rem;
  right: 0;
  background: #ff4d4d;
  color: white;
  padding: 0.4rem 0.8rem;
  border: none;
  font-weight: bold;
  border-radius: 6px;
  cursor: pointer;
}
  </style>
</head>
<body>
  <header>
    <div class="header-left">
      <a href="../index.html"><img src="../assets/mediux.svg" alt="Mediux Logo" height="28" /></a>
      <h1>Poster Overlay</h1>
    </div>
    <div class="header-center">
      <a href="../index.html"><img src="../assets/logo.png" alt="Poster Tools" class="poster-tools-brand" /></a>
    </div>
  </header>

  <div class="layout">
    <div class="sidebar">
	  <div class="tmdb-search">
	    <input type="text" id="tmdb-search-input" placeholder="Search TMDB..." autocomplete="off" />
		<div class="autocomplete-suggestions" id="tmdb-suggestions"></div>
	  </div>
	  
      <label for="poster-upload" class="drop-zone-label">Upload Poster</label>
      <input type="file" id="poster-upload" accept="image/*">

      <label for="overlay-select">Choose Overlay</label>
      <select id="overlay-select">
        <option value="../assets/overlays/4K with DV.png">4K with DV</option>
        <option value="../assets/overlays/4K with HDR.png">4K with HDR</option>
        <option value="../assets/overlays/4K no HDR.png">4K no HDR</option>
      </select>

      <button id="download-btn">Download Poster</button>
      <button id="reset-btn">Reset</button>
    </div>

    <div class="main">
  <div class="main-content">
    <div class="canvas-container">
      <canvas id="overlay-canvas" width="1000" height="1500"></canvas>
    </div>

    <div class="metadata-panel" id="metadata-panel" style="display: none;">
      <div class="title-row">
        <h2 id="meta-title">Movie Title</h2>
        <span class="rating-badge" id="meta-rating"></span>
      </div>
      <div id="meta-tagline" class="tagline"></div>

      <div class="info-group">
        <div class="info-item"><span class="label">Year:</span> <span id="meta-year"></span></div>
        <div class="info-item"><span class="label">Runtime:</span> <span id="meta-runtime"></span></div>
        <div class="info-item"><span class="label">Genres:</span> <span id="meta-genres"></span></div>
        <div class="info-item"><span class="label">Director:</span> <span id="meta-director"></span></div>
        <div class="info-item"><span class="label">Cast:</span> <span id="meta-cast"></span></div>
        <div class="info-item"><span class="label">Language:</span> <span id="meta-language"></span></div>
        <div class="info-item"><span class="label">Country:</span> <span id="meta-country"></span></div>
      </div>

      <div class="overview" id="meta-overview"></div>
    </div>
  </div>

  <!-- Poster Modal inserted BELOW canvas and metadata -->
  <div id="poster-modal" style="display: none;">
    <button class="close-modal" onclick="document.getElementById('poster-modal').style.display='none'">Close</button>
    <div class="poster-grid-wrapper">
	 <div class="poster-grid" id="poster-results"></div>
  </div>
</div>

  <script>
    const posterUpload = document.getElementById('poster-upload');
    const overlaySelect = document.getElementById('overlay-select');
    const canvas = document.getElementById('overlay-canvas');
    const ctx = canvas.getContext('2d');
    let baseImage = null;
    let overlayImage = new Image();

    const metaPanel = document.getElementById('metadata-panel');
    const TMDB_API_KEY = '96c821c9e98fab6a43bff8021d508d1d';

    posterUpload.addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(evt) {
        baseImage = new Image();
        baseImage.onload = () => {
          drawCanvas();
          fetchMetadata(file.name);
        };
        baseImage.src = evt.target.result;
      };
      reader.readAsDataURL(file);
    });

    overlaySelect.addEventListener('change', () => {
      if (!baseImage) return;
      drawCanvas();
    });

    function drawCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(baseImage, 0, 0, canvas.width, canvas.height);

      overlayImage = new Image();
      overlayImage.onload = () => {
        ctx.drawImage(overlayImage, 0, 0, canvas.width, canvas.height);
      };
      overlayImage.src = overlaySelect.value;
    }

    function fetchMetadata(filename) {
      const cleanName = filename.replace(/\.[^/.]+$/, '').replace(/[_-]/g, ' ');
      fetch(`https://api.themoviedb.org/3/search/movie?query=${encodeURIComponent(cleanName)}&api_key=${TMDB_API_KEY}`)
        .then(res => res.json())
        .then(data => {
          if (data.results?.length > 0) {
            const movie = data.results[0];
            fetch(`https://api.themoviedb.org/3/movie/${movie.id}?api_key=${TMDB_API_KEY}&append_to_response=credits`)
              .then(res => res.json())
              .then(details => {
			  
			    document.getElementById('meta-title').textContent = details.title;
                document.getElementById('meta-rating').textContent = details.vote_average.toFixed(1);
                document.getElementById('meta-tagline').textContent = details.tagline || '';
				
				const director = details.credits.crew.find(p => p.job === 'Director');
                const cast = details.credits.cast.slice(0, 5).map(p => p.name).join(', ');
                
				document.getElementById('meta-year').textContent = details.release_date?.slice(0, 4);
				document.getElementById('meta-runtime').textContent = `${details.runtime} mins`;
				document.getElementById('meta-genres').textContent = details.genres.map(g => g.name).join(', ');
				document.getElementById('meta-director').textContent = director?.name || '—';
				document.getElementById('meta-cast').textContent = cast || '—';
				document.getElementById('meta-language').textContent = details.original_language.toUpperCase();
				document.getElementById('meta-country').textContent = details.production_countries?.[0]?.name || '—';
                document.getElementById('meta-overview').textContent = details.overview;

                metaPanel.style.display = 'flex';
              });
          }
        });
    }
	const searchInput = document.getElementById('tmdb-search-input');
    const suggestionsBox = document.getElementById('tmdb-suggestions');

searchInput.addEventListener('input', () => {
  const query = searchInput.value.trim();
  if (!query) {
    suggestionsBox.innerHTML = '';
    return;
  }

  fetch(`https://api.themoviedb.org/3/search/movie?query=${encodeURIComponent(query)}&api_key=${TMDB_API_KEY}&language=en-US&include_adult=false`)
    .then(res => res.json())
    .then(data => {
      const results = data.results
        .filter(movie => movie.poster_path && movie.original_language === 'en')
        .slice(0, 10);

      suggestionsBox.innerHTML = '';
      results.forEach(movie => {
        const div = document.createElement('div');
        div.textContent = `${movie.title} (${movie.release_date?.slice(0, 4) || '—'})`;
        div.addEventListener('click', () => {
          searchInput.value = movie.title;
          suggestionsBox.innerHTML = '';
          fetchAndDisplayPostersById(movie.id, movie.title);
        });
        suggestionsBox.appendChild(div);
      });
    });
});

document.addEventListener('click', (e) => {
  if (!e.target.closest('.tmdb-search')) {
    suggestionsBox.innerHTML = '';
  }
});
function fetchAndDisplayPostersById(movieId, movieTitle) {
  const container = document.getElementById('poster-results');
  container.innerHTML = ''; // Clear existing

  fetch(`https://api.themoviedb.org/3/movie/${movieId}/images?api_key=${TMDB_API_KEY}`)
    .then(res => res.json())
    .then(images => {
      const posters = images.posters
        .filter(p => p.iso_639_1 === 'en')
        .slice(0, 30); // Show max 10

      if (posters.length === 0) {
        container.innerHTML = '<p style="color:white;">No posters found.</p>';
        return;
      }

      posters.forEach(poster => {
        const img = document.createElement('img');
        img.src = `https://image.tmdb.org/t/p/w500${poster.file_path}`;
        img.alt = movieTitle;
        img.title = movieTitle;

        img.addEventListener('click', () => {
          const image = new Image();
          image.crossOrigin = 'anonymous';
          image.onload = () => {
            baseImage = image;
            drawCanvas();
            fetchMetadata(movieTitle);
            document.getElementById('poster-modal').style.display = 'flex';
          };
          image.src = img.src;
        });

        container.appendChild(img);
      });
	  
      container.scrollLeft = 0;
	  
      document.getElementById('poster-modal').style.display = 'flex';
    })
    .catch(err => {
      container.innerHTML = '<p style="color:white;">Error loading posters.</p>';
      console.error(err);
    });
}
    document.getElementById('download-btn').addEventListener('click', () => {
      const link = document.createElement('a');
      link.download = 'poster-overlay.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    });

    document.getElementById('reset-btn').addEventListener('click', () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      posterUpload.value = '';
      baseImage = null;
      metaPanel.style.display = 'none';
	  
	  document.getElementById('tmdb-search-input').value = '';
      document.getElementById('tmdb-suggestions').innerHTML = '';
	  
	  document.getElementById('poster-modal').style.display = 'none';
      document.getElementById('poster-results').innerHTML = '';
    });
  </script>
</body>
</html>
